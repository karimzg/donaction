<p-fileupload [name]="mediaField()"
              [url]="endpoint[0]()"
              [auto]="false"
              [multiple]="false"
              [headers]="headers()"
              [disabled]="disabled()"
              accept="{{fileTypes()}}"
              [maxFileSize]="allowVideo() ? 20000000 : 10000000"
              invalidFileSizeMessageSummary="Taille de fichier invalide"
              invalidFileSizeMessageDetail="La taille du fichier ne doit pas dépasser 10Mo"
              invalidFileTypeMessageDetail="Les fichiers autorisés sont les images"
              invalidFileTypeMessageSummary="Type de fichier invalide"
              invalidFileLimitMessageDetail="Un seul fichier est autorisé"
              invalidFileLimitMessageSummary="Nombre de fichiers invalide"
              (onUpload)="onUpload($event)"
              (onSelect)="onSelectionChange($event)"
              (onError)="onError($event)"
              (onRemove)="onRemove($event)"
              (onProgress)="onProgress($event)"
              (onBeforeUpload)="onBeforeUpload($event)"
              [customUpload]="customUpload()"
              (uploadHandler)="onUploadHandler($event)"
              #fileUpload
              class="p-file-upload-container"
              [ngClass]="{'p-fileupload-error': control().errors && control().touched}">
  >
  <ng-template #header></ng-template>
  <ng-template #content let-files let-chooseCallback="chooseCallback" let-clearCallback="clearCallback">
    @if (control()) {
      @if (safeUrl() || control()!.value) {
        @if (mediaType() === 'doc') {
          <div class="flex flex-row justify-content-between gap-2 m-2">
            <div class="flex flex-row items-center gap-2 overflow-hidden">
              @if (loading()) {
                <i class="pi pi-spin pi-spinner text-[1.5rem] text-[#64748B] p-3 bg-[#E4E4E5] rounded-full"></i>
              } @else if (control()!.pristine) {
                <i
                  class="pi pi-cloud-download text-[1.5rem] text-[#64748B] p-3 bg-[#E4E4E5] rounded-full cursor-pointer"
                  (click)="onDownloadFile.emit(control()!.value.name)"></i>
              } @else {
                <i class="pi pi-file text-[1.5rem] text-[#64748B] p-3 bg-[#E4E4E5] rounded-full"></i>
              }
              <div class="flex flex-col overflow-hidden">
                <div class="flex flex-row gap-2.5">
                  <span
                    class="m-0 overflow-hidden text-ellipsis inline-block whitespace-nowrap w-full"> {{ control()!.value.name }}</span>
                </div>
                <div class="flex">
                  <p class="text-[#64748B] mb-0"> {{ control()!.value.size | fileSize }}</p>
                  @if (control()!.pristine) {
                    <app-validated-info
                      (onclick)="onValidatedClick.emit()"
                      class="ml-2"
                      [clickable]="!!permissionsService.memberIsAtLeastAdminEditorSignal()"
                      [validated]="validatedDocument()"></app-validated-info>
                  }
                </div>
              </div>
            </div>
            <div class="flex flex-row items-center gap-2">
              <div
                class="flex flex-wrap justify-content-between items-center flex-1 gap-2">
                <div class="flex gap-2">
                  <p-button (onClick)="choose($event, chooseCallback)" icon="pi pi-pencil" [rounded]="true"
                            [outlined]="false" [disabled]="disabled() || loading()"/>
                  <p-button (onClick)="reset(clearCallback)" icon="pi pi-trash" [rounded]="true" [outlined]="false"
                            severity="danger" [disabled]="disabled() || loading() || !files || files.length === 0"/>
                </div>
              </div>
            </div>
          </div>
        } @else {

          <div class="relative p-fileupload-content-wrapper flex flex-col gap-3 items-center">
            <div class="m-0 flex flex-1 justify-center">
              <div class="max-w-full flex flex-col justify-content-center">
                @switch (mediaType()) {
                  @case ('img') {
                    <img class="rounded max-h-[220px]" role="presentation" [alt]="control()!.value"
                         [src]="safeUrl() || control()!.value" width="100%" height="auto"/>
                  }
                  @case ('video') {
                    <video [src]="safeUrl() || control()!.value" class="max-w-full max-h-96"
                           controls></video> <!--class="uploaded-image w-{{mediaPreviewWidth()}}"-->
                  }
                }
              </div>
            </div>
            <div
              class="flex flex-wrap justify-content-between items-center flex-1 gap-2 md:absolute md:bottom-3 md:right-4">
              <div class="flex gap-2">
                <p-button (onClick)="choose($event, chooseCallback)" icon="pi pi-pencil" [rounded]="true"
                          [outlined]="false" [disabled]="disabled() || loading()"/>
                <p-button (onClick)="reset(clearCallback)" icon="pi pi-trash" [rounded]="true" [outlined]="false"
                          severity="danger" [disabled]="disabled() || loading() || !files || files.length === 0"/>
              </div>
            </div>
          </div>
        }
      } @else {
        <div
          class="p-fileupload-content-wrapper flex align-items-center gap-2"
          [ngClass]="size() === 'sm' ? 'align-items-center cursor-pointer m-2' : 'justify-content-center flex-column cursor-pointer'"
          (click)="fileUpload.choose()">
          <i class="pi pi-cloud-upload border-2 border-circle text-400 border-400 hover:shadow"
             [ngClass]="{
            'text-4xl px-2.5 py-2.5': size() === 'sm',
            'text-6xl px-4 py-3.5': size() === 'md',
            'text-8xl p-5': size() === 'lg',
            }"
          ></i>
          <div>
            <ng-content></ng-content>
          </div>
        </div>
      }
    }
  </ng-template>
  <ng-template #file></ng-template>
  <code>control: ({{ control().value }})</code>
  <!--@if (control() && !control()!.value) {
    <ng-template #empty>
      <div
        class="p-fileupload-content-wrapper flex align-items-center justify-content-center flex-column cursor-pointer gap-2"
        (click)="fileUpload.choose()">
        <i class="pi pi-cloud-upload border-2 border-circle text-400 border-400"
           [ngClass]="{
            'text-4xl px-3 py-2.5': size() === 'sm',
            'text-6xl px-4 py-3.5': size() === 'md',
            'text-8xl p-5': size() === 'lg',
            }"
        ></i>
        <ng-content></ng-content>
      </div>
    </ng-template>
  }-->
</p-fileupload>
